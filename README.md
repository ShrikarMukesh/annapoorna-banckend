# Annapoorna Backend

Welcome to the backend repository for **Annapoorna**, a food delivery application. This project is built using a **Microservices Architecture** with **Spring Boot**, ensuring scalability, resilience, and maintainability.

## üèóÔ∏è Architecture

The system uses **Spring Cloud Gateway** as the single entry point and **Netflix Eureka** for service discovery.

```mermaid
graph TD
    Client[Client Apps<br/>Web/Mobile] --> Gateway[API Gateway<br/>Port: 9190]
    
    subgraph Infrastructure
        Gateway --> Discovery[Discovery Server<br/>Eureka - Port: 8761]
    end
    
    subgraph Microservices
        Gateway --> Auth[User Management<br/>Auth Service]
        Gateway --> Order[Order Service]
        Gateway --> Rest[Restaurant Service]
        Gateway --> Cust[Customers Service]
        Gateway --> Inv[Inventory Service]
        Gateway --> Rev[Review & Rating Service]
    end
    
    Auth -.-> DB[(Database)]
    Order -.-> DB
    Rest -.-> DB
```

## üöÄ Key Flows

### üîê Authentication Flow

The `user-management` service handles secure access using JWT and supports both Email/Password and OTP-based login.

```mermaid
sequenceDiagram
    actor User
    participant Client
    participant Gateway
    participant Auth as Auth Controller
    participant DB as Database
    participant JWT as JWT Provider
    participant OTP as OTP Util

    Note over User, Auth: Sign Up / Registration
    User->>Client: Enters Details
    Client->>Gateway: POST /auth/signup
    Gateway->>Auth: Forward Request
    Auth->>DB: Check Email Exists
    alt Email Exists
        Auth-->>Client: Error: Email already exists
    else New User
        Auth->>DB: Save User (Role: Customer)
        Auth->>DB: Create Cart
        Auth->>JWT: Generate Token
        JWT-->>Auth: JWT Token
        Auth-->>Client: AuthResponse (JWT, Role, UserId)
    end

    Note over User, Auth: Login (Email & Password)
    User->>Client: Enter Credentials
    Client->>Gateway: POST /auth/signin
    Gateway->>Auth: Forward Request
    Auth->>DB: Optimize Fetch User
    Auth->>Auth: Validate Password
    Auth->>JWT: Generate Token
    Auth-->>Client: AuthResponse (JWT)

    Note over User, Auth: OTP Login
    User->>Client: Request OTP (Phone)
    Client->>Gateway: POST /auth/otp/send
    Gateway->>Auth: Forward
    Auth->>OTP: Generate OTP
    Auth->>DB: Save/Update VerificationCode
    Auth-->>Client: "OTP sent successfully"
    
    User->>Client: Enter OTP
    Client->>Gateway: POST /auth/otp/login
    Gateway->>Auth: Verify OTP
    Auth->>DB: Check OTP & Expiry
    alt Valid OTP
        opt New Phone Number
             Auth->>DB: Register New User
             Auth->>DB: Create Cart
        end
        Auth->>JWT: Generate Token
        Auth-->>Client: AuthResponse (JWT)
    else Invalid
        Auth-->>Client: Error: Invalid/Expired OTP
    end
```

## üì¶ Service Registry

| Service Name | Port | Description |
| :--- | :--- | :--- |
| **Api Gateway** | `9190` | Routing, filtering, and entry point. |
| **Discovery Server** | `8761` | Eureka server for service registration. |
| **User Management** | *Dynamic* | Auth, User profiles, OTP handling. |
| **Order Service** | *Dynamic* | Order processing and management. |
| **Restaurant Service** | *Dynamic* | Restaurant listings and menu management. |
| **Customers Service** | *Dynamic* | Customer specific data and logic. |
| **Inventory Service** | *Dynamic* | Stock and ingredient management. |
| **Review Service** | *Dynamic* | Ratings and reviews for restaurants/items. |
| **Notification Service** | *Dynamic* | Email/SMS notifications. |

## üõ†Ô∏è Tech Stack

- **Java 17+**
- **Spring Boot 3.x**
- **Spring Cloud** (Gateway, Netflix Eureka, OpenFeign)
- **Spring Security** & **JWT**
- **Database**: SQL (MySQL/PostgreSQL) / NoSQL (MongoDB) - *configured per service*
- **Build Tool**: Maven

## üèÅ Getting Started

1.  **Start the Discovery Server**:
    Run the `discovery-server` application first.
    ```bash
    cd discovery-server
    ./mvnw spring-boot:run
    ```

2.  **Start Microservices**:
    Start the required backend services (`user-management`, `order-service`, etc.).

3.  **Start the API Gateway**:
    Finally, start the `api-gateway` to route traffic.
    ```bash
    cd api-gateway
    ./mvnw spring-boot:run
    ```

4.  **Access the App**:
    The API Gateway is available at `http://localhost:9190`.

---
*Generated by Google Deepmind's Agentic Coding Assistant*